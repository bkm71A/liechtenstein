{"paragraphs":[{"text":"val biddingSessions = sqlc\r\n  .read\r\n  .format(\"org.apache.spark.sql.cassandra\")\r\n  .options(Map( \"table\" -> \"bidding_bundle\", \"keyspace\" -> \"mss\"))\r\n  .load()\r\n  \r\nbiddingSessions.registerTempTable(\"bidding_bundle\")","authenticationInfo":{},"dateUpdated":"Jun 6, 2016 11:19:35 AM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala","editorHide":true,"tableHide":true,"title":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1464728824047_-424820128","id":"20160531-210704_690837214","result":{"code":"SUCCESS","type":"TEXT","msg":"biddingSessions: org.apache.spark.sql.DataFrame = [ipinyou_id: string, ts: timestamp, bid_id: string, ad_exchange: smallint, ad_slot_format: string, ad_slot_height: int, ad_slot_id: string, ad_slot_visibility: int, ad_slot_width: int, advertiser_id: int, anonymous_url: string, bidding_price: decimal(38,18), city: int, creative_id: string, domain: string, ext_ad_exchange: struct<id:smallint,name:string,description:string>, ext_city: struct<id:int,name:string,state_id:int,population:int,area:float,density:float,latitude:float,longitude:float>, ext_log_type: struct<id:int,name:string>, ext_state: struct<id:int,name:string,population:int,gsp:int>, ext_user_agent: struct<ua_type:string,ua_family:string,os_name:string,device:string>, ext_user_tags: struct<id:bigint,keywords:array<string>,stat..."},"dateCreated":"May 31, 2016 9:07:04 PM","dateStarted":"Jun 6, 2016 8:04:34 AM","dateFinished":"Jun 6, 2016 8:04:35 AM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1822","title":"Defining a bidding_bundle table"},{"text":"sqlc.sql(\"\"\"\n    SELECT \n        browser,\n        os,\n        device,\n        ipinyou_id,\n        count(*) cnt,\n        dt\n    FROM (\n        SELECT \n            ipinyou_id,\n            ext_user_agent.ua_family browser,\n            ext_user_agent.os_name os,\n            ext_user_agent.device device,\n            dt\n        FROM (\n            SELECT\n                ipinyou_id,\n                ext_user_agent,\n                CAST(FLOOR(CAST(ts AS BIGINT) / 86400) * 86400 AS BIGINT) dt\n            FROM bidding_bundle\n            WHERE stream_id = 11 and (ipinyou_id IS NOT NULL and ipinyou_id <> 'null' and ipinyou_id <> '')\n    ) t ) t1\n    GROUP BY \n        dt,\n        browser,\n        os,\n        device,\n        ipinyou_id\n\"\"\").registerTempTable(\"clicks_per_day\")","authenticationInfo":{},"dateUpdated":"Jun 6, 2016 11:20:10 AM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala","editorHide":true,"tableHide":false,"title":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1464728886585_-860078403","id":"20160531-210806_17552556","result":{"code":"SUCCESS","type":"TEXT","msg":""},"dateCreated":"May 31, 2016 9:08:06 PM","dateStarted":"Jun 6, 2016 8:04:35 AM","dateFinished":"Jun 6, 2016 8:04:36 AM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1823","title":"Gathering clicks_per_day data"},{"title":"Customer Distribution Over Time","text":"%sql\nWITH segments AS (\n    SELECT \n        ipinyou_id,\n        dt,\n        CASE \n            WHEN prec_cnt_1 > 1 THEN 3\n            WHEN prec_cnt_1 = 1 THEN 2\n            WHEN prec_cnt_all = 0 THEN 1\n            ELSE 0\n        END curr_seg_id,\n        CASE \n            WHEN following_cnt_1 = 0 AND prec_cnt_2 + cnt > 1 THEN 5\n            WHEN following_cnt_1 = 0 THEN 4\n            ELSE -1\n        END roll_seg_id_1,\n        CASE \n            WHEN following_cnt_2 = 0 AND prec_cnt_1 + cnt > 1 THEN 5\n            WHEN following_cnt_2 = 0 THEN 4\n            ELSE -1\n        END roll_seg_id_2,\n        CASE \n            WHEN following_cnt_3 = 0 AND cnt > 1 THEN 5\n            WHEN following_cnt_3 = 0 THEN 4\n            ELSE -1\n        END roll_seg_id_3\n    FROM (\n        SELECT\n            ipinyou_id,\n            SUM(cnt) OVER (PARTITION BY ipinyou_id ORDER BY dt RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) - cnt prec_cnt_all,\n            SUM(cnt) OVER (PARTITION BY ipinyou_id ORDER BY dt RANGE BETWEEN 172800 PRECEDING AND CURRENT ROW) - cnt prec_cnt_2,\n            SUM(cnt) OVER (PARTITION BY ipinyou_id ORDER BY dt RANGE BETWEEN 86400 PRECEDING AND CURRENT ROW) - cnt prec_cnt_1,\n            cnt,\n            SUM(cnt) OVER (PARTITION BY ipinyou_id ORDER BY dt RANGE BETWEEN CURRENT ROW AND 86400 FOLLOWING) - cnt following_cnt_1,\n            SUM(cnt) OVER (PARTITION BY ipinyou_id ORDER BY dt RANGE BETWEEN CURRENT ROW AND 172800 FOLLOWING) - cnt following_cnt_2,\n            SUM(cnt) OVER (PARTITION BY ipinyou_id ORDER BY dt RANGE BETWEEN CURRENT ROW AND 259200 FOLLOWING) - cnt following_cnt_3,\n            dt\n        FROM (\n            SELECT \n                ipinyou_id, \n                dt, \n                SUM(cnt) cnt \n            from clicks_per_day \n            WHERE \n                device like \"${Device=%%),%%(All)|Computer|Digital media receiver|Game console|Mobile|Tablet|Unknown}\"\n                AND browser like \"${Browser=%%,%%(All)|Apple WebKit|CFNetwork|Camino|Chrome|Downloading Tool|Firefox|Flock|Internet Explorer|Konqueror|Microsoft Edge|Mozilla|NetFront|Omniweb|Opera|Outlook|Robot/Spider|Safari|Samsung Dolphin 2|SeaMonkey|Thunderbird|Unknown}\"\n                AND os like \"${OS=%%,%%(All)|Android|Android (Google TV)|Android 1.x|Android 2.x|Android 2.x Tablet|Android 3.x Tablet|Android 4.x|Android 4.x Tablet|Android 5.x|Android 5.x Tablet|Android 6.x|Android 6.x Tablet|Android Mobile|Android Tablet|Bada|BlackBerry 6|BlackBerry 7|BlackBerry Tablet OS|BlackBerryOS|Chrome OS|Linux|Mac OS|Mac OS X|Mac OS X (iPad)|Mac OS X (iPhone)|Mac OS X (iPod)|Maemo|MeeGo|Nintendo Wii|PalmOS|Series 40|Sony Ericsson|Sony Playstation|SunOS|Symbian OS|Symbian OS 7.x|Symbian OS 8.x|Symbian OS 9.x|Ubuntu|Unknown|Unknown mobile|Unknown tablet|WebOS|Windows|Windows 2000|Windows 7|Windows 8|Windows 8.1|Windows 98|Windows Mobile|Windows Phone 7|Windows Phone 8|Windows Vista|Windows XP|Xbox OS|iOS|iOS 4 (iPhone)|iOS 5 (iPhone)|iOS 6 (iPad)|iOS 6 (iPhone)|iOS 7 (iPhone)}\"\n            GROUP BY ipinyou_id, dt) t0\n    ) t1\n)\nSELECT \n    FROM_UNIXTIME(report_dt) report_dt, \n    count(*) as cnt_sum,\n    case \n        when segment_id = 1 then 'New'\n        when segment_id = 2 then 'Current Repeat'\n        when segment_id = 3 then 'Current High Repeat'\n        when segment_id = 4 then 'Active Rolling 3D'\n        when segment_id = 5 then 'Active Rolling 3D Repeater'\n        else 'Other' \n    end segment_name\nFROM (\n    SELECT \n        t2.report_dt, \n        t2.seg segment_id\n    FROM segments t1\n    --unpivoting\n    LATERAL VIEW explode (map(\n      dt, curr_seg_id,\n      dt+86400, roll_seg_id_1,\n      dt+172800, roll_seg_id_2,\n      dt+259200, roll_seg_id_3\n    )) t2 as report_dt, seg\n) t\nWHERE segment_id <> -1\nGROUP BY report_dt, segment_id\nORDER BY report_dt","authenticationInfo":{},"dateUpdated":"Jun 6, 2016 8:04:34 AM","config":{"colWidth":12,"graph":{"mode":"lineChart","height":300,"optionOpen":false,"keys":[{"name":"report_dt","index":0,"aggr":"sum"}],"values":[{"name":"cnt_sum","index":1,"aggr":"sum"}],"groups":[{"name":"segment_name","index":2,"aggr":"sum"}],"scatter":{"xAxis":{"name":"report_dt","index":0,"aggr":"sum"},"yAxis":{"name":"cnt_sum","index":1,"aggr":"sum"}}},"enabled":true,"editorMode":"ace/mode/sql","editorHide":true,"title":true},"settings":{"params":{"OS":"%%","Device":"%%","Browser":"%%"},"forms":{"OS":{"name":"OS","defaultValue":"%%","options":[{"value":"%%","displayName":"All","$$hashKey":"object:2091"},{"value":"Android","$$hashKey":"object:2092"},{"value":"Android ","displayName":"Google TV","$$hashKey":"object:2093"},{"value":"Android 1.x","$$hashKey":"object:2094"},{"value":"Android 2.x","$$hashKey":"object:2095"},{"value":"Android 2.x Tablet","$$hashKey":"object:2096"},{"value":"Android 3.x Tablet","$$hashKey":"object:2097"},{"value":"Android 4.x","$$hashKey":"object:2098"},{"value":"Android 4.x Tablet","$$hashKey":"object:2099"},{"value":"Android 5.x","$$hashKey":"object:2100"},{"value":"Android 5.x Tablet","$$hashKey":"object:2101"},{"value":"Android 6.x","$$hashKey":"object:2102"},{"value":"Android 6.x Tablet","$$hashKey":"object:2103"},{"value":"Android Mobile","$$hashKey":"object:2104"},{"value":"Android Tablet","$$hashKey":"object:2105"},{"value":"Bada","$$hashKey":"object:2106"},{"value":"BlackBerry 6","$$hashKey":"object:2107"},{"value":"BlackBerry 7","$$hashKey":"object:2108"},{"value":"BlackBerry Tablet OS","$$hashKey":"object:2109"},{"value":"BlackBerryOS","$$hashKey":"object:2110"},{"value":"Chrome OS","$$hashKey":"object:2111"},{"value":"Linux","$$hashKey":"object:2112"},{"value":"Mac OS","$$hashKey":"object:2113"},{"value":"Mac OS X","$$hashKey":"object:2114"},{"value":"Mac OS X ","displayName":"iPad","$$hashKey":"object:2115"},{"value":"Mac OS X ","displayName":"iPhone","$$hashKey":"object:2116"},{"value":"Mac OS X ","displayName":"iPod","$$hashKey":"object:2117"},{"value":"Maemo","$$hashKey":"object:2118"},{"value":"MeeGo","$$hashKey":"object:2119"},{"value":"Nintendo Wii","$$hashKey":"object:2120"},{"value":"PalmOS","$$hashKey":"object:2121"},{"value":"Series 40","$$hashKey":"object:2122"},{"value":"Sony Ericsson","$$hashKey":"object:2123"},{"value":"Sony Playstation","$$hashKey":"object:2124"},{"value":"SunOS","$$hashKey":"object:2125"},{"value":"Symbian OS","$$hashKey":"object:2126"},{"value":"Symbian OS 7.x","$$hashKey":"object:2127"},{"value":"Symbian OS 8.x","$$hashKey":"object:2128"},{"value":"Symbian OS 9.x","$$hashKey":"object:2129"},{"value":"Ubuntu","$$hashKey":"object:2130"},{"value":"Unknown","$$hashKey":"object:2131"},{"value":"Unknown mobile","$$hashKey":"object:2132"},{"value":"Unknown tablet","$$hashKey":"object:2133"},{"value":"WebOS","$$hashKey":"object:2134"},{"value":"Windows","$$hashKey":"object:2135"},{"value":"Windows 2000","$$hashKey":"object:2136"},{"value":"Windows 7","$$hashKey":"object:2137"},{"value":"Windows 8","$$hashKey":"object:2138"},{"value":"Windows 8.1","$$hashKey":"object:2139"},{"value":"Windows 98","$$hashKey":"object:2140"},{"value":"Windows Mobile","$$hashKey":"object:2141"},{"value":"Windows Phone 7","$$hashKey":"object:2142"},{"value":"Windows Phone 8","$$hashKey":"object:2143"},{"value":"Windows Vista","$$hashKey":"object:2144"},{"value":"Windows XP","$$hashKey":"object:2145"},{"value":"Xbox OS","$$hashKey":"object:2146"},{"value":"iOS","$$hashKey":"object:2147"},{"value":"iOS 4 ","displayName":"iPhone","$$hashKey":"object:2148"},{"value":"iOS 5 ","displayName":"iPhone","$$hashKey":"object:2149"},{"value":"iOS 6 ","displayName":"iPad","$$hashKey":"object:2150"},{"value":"iOS 6 ","displayName":"iPhone","$$hashKey":"object:2151"},{"value":"iOS 7 ","displayName":"iPhone","$$hashKey":"object:2152"}],"hidden":false},"Device":{"name":"Device","defaultValue":"%%)","options":[{"value":"%%","displayName":"All","$$hashKey":"object:2156"},{"value":"Computer","$$hashKey":"object:2157"},{"value":"Digital media receiver","$$hashKey":"object:2158"},{"value":"Game console","$$hashKey":"object:2159"},{"value":"Mobile","$$hashKey":"object:2160"},{"value":"Tablet","$$hashKey":"object:2161"},{"value":"Unknown","$$hashKey":"object:2162"}],"hidden":false},"Browser":{"name":"Browser","defaultValue":"%%","options":[{"value":"%%","displayName":"All","$$hashKey":"object:2166"},{"value":"Apple WebKit","$$hashKey":"object:2167"},{"value":"CFNetwork","$$hashKey":"object:2168"},{"value":"Camino","$$hashKey":"object:2169"},{"value":"Chrome","$$hashKey":"object:2170"},{"value":"Downloading Tool","$$hashKey":"object:2171"},{"value":"Firefox","$$hashKey":"object:2172"},{"value":"Flock","$$hashKey":"object:2173"},{"value":"Internet Explorer","$$hashKey":"object:2174"},{"value":"Konqueror","$$hashKey":"object:2175"},{"value":"Microsoft Edge","$$hashKey":"object:2176"},{"value":"Mozilla","$$hashKey":"object:2177"},{"value":"NetFront","$$hashKey":"object:2178"},{"value":"Omniweb","$$hashKey":"object:2179"},{"value":"Opera","$$hashKey":"object:2180"},{"value":"Outlook","$$hashKey":"object:2181"},{"value":"Robot/Spider","$$hashKey":"object:2182"},{"value":"Safari","$$hashKey":"object:2183"},{"value":"Samsung Dolphin 2","$$hashKey":"object:2184"},{"value":"SeaMonkey","$$hashKey":"object:2185"},{"value":"Thunderbird","$$hashKey":"object:2186"},{"value":"Unknown","$$hashKey":"object:2187"}],"hidden":false}}},"jobName":"paragraph_1464729847896_1088313574","id":"20160531-212407_493597292","result":{"code":"SUCCESS","type":"TABLE","msg":"report_dt\tcnt_sum\tsegment_name\n2013-06-06 00:00:00\t7016\tNew\n2013-06-07 00:00:00\t7006\tActive Rolling 3D\n2013-06-07 00:00:00\t10\tActive Rolling 3D Repeater\n2013-06-07 00:00:00\t3298\tNew\n2013-06-08 00:00:00\t1\tCurrent Repeat\n2013-06-08 00:00:00\t16\tActive Rolling 3D Repeater\n2013-06-08 00:00:00\t10297\tActive Rolling 3D\n2013-06-08 00:00:00\t3163\tNew\n2013-06-09 00:00:00\t13457\tActive Rolling 3D\n2013-06-09 00:00:00\t20\tActive Rolling 3D Repeater\n2013-06-10 00:00:00\t6451\tActive Rolling 3D\n2013-06-10 00:00:00\t10\tActive Rolling 3D Repeater\n2013-06-11 00:00:00\t3160\tActive Rolling 3D\n2013-06-11 00:00:00\t4\tActive Rolling 3D Repeater\n2013-06-11 00:00:00\t92\tNew\n2013-06-12 00:00:00\t92\tActive Rolling 3D\n2013-06-13 00:00:00\t92\tActive Rolling 3D\n2013-06-14 00:00:00\t92\tActive Rolling 3D\n","comment":"","msgTable":[[{"key":"cnt_sum","value":"2013-06-06 00:00:00"},{"key":"cnt_sum","value":"7016"},{"key":"cnt_sum","value":"New"}],[{"key":"segment_name","value":"2013-06-07 00:00:00"},{"key":"segment_name","value":"7006"},{"key":"segment_name","value":"Active Rolling 3D"}],[{"value":"2013-06-07 00:00:00"},{"value":"10"},{"value":"Active Rolling 3D Repeater"}],[{"value":"2013-06-07 00:00:00"},{"value":"3298"},{"value":"New"}],[{"value":"2013-06-08 00:00:00"},{"value":"1"},{"value":"Current Repeat"}],[{"value":"2013-06-08 00:00:00"},{"value":"16"},{"value":"Active Rolling 3D Repeater"}],[{"value":"2013-06-08 00:00:00"},{"value":"10297"},{"value":"Active Rolling 3D"}],[{"value":"2013-06-08 00:00:00"},{"value":"3163"},{"value":"New"}],[{"value":"2013-06-09 00:00:00"},{"value":"13457"},{"value":"Active Rolling 3D"}],[{"value":"2013-06-09 00:00:00"},{"value":"20"},{"value":"Active Rolling 3D Repeater"}],[{"value":"2013-06-10 00:00:00"},{"value":"6451"},{"value":"Active Rolling 3D"}],[{"value":"2013-06-10 00:00:00"},{"value":"10"},{"value":"Active Rolling 3D Repeater"}],[{"value":"2013-06-11 00:00:00"},{"value":"3160"},{"value":"Active Rolling 3D"}],[{"value":"2013-06-11 00:00:00"},{"value":"4"},{"value":"Active Rolling 3D Repeater"}],[{"value":"2013-06-11 00:00:00"},{"value":"92"},{"value":"New"}],[{"value":"2013-06-12 00:00:00"},{"value":"92"},{"value":"Active Rolling 3D"}],[{"value":"2013-06-13 00:00:00"},{"value":"92"},{"value":"Active Rolling 3D"}],[{"value":"2013-06-14 00:00:00"},{"value":"92"},{"value":"Active Rolling 3D"}]],"columnNames":[{"name":"report_dt","index":0,"aggr":"sum"},{"name":"cnt_sum","index":1,"aggr":"sum"},{"name":"segment_name","index":2,"aggr":"sum"}],"rows":[["2013-06-06 00:00:00","7016","New"],["2013-06-07 00:00:00","7006","Active Rolling 3D"],["2013-06-07 00:00:00","10","Active Rolling 3D Repeater"],["2013-06-07 00:00:00","3298","New"],["2013-06-08 00:00:00","1","Current Repeat"],["2013-06-08 00:00:00","16","Active Rolling 3D Repeater"],["2013-06-08 00:00:00","10297","Active Rolling 3D"],["2013-06-08 00:00:00","3163","New"],["2013-06-09 00:00:00","13457","Active Rolling 3D"],["2013-06-09 00:00:00","20","Active Rolling 3D Repeater"],["2013-06-10 00:00:00","6451","Active Rolling 3D"],["2013-06-10 00:00:00","10","Active Rolling 3D Repeater"],["2013-06-11 00:00:00","3160","Active Rolling 3D"],["2013-06-11 00:00:00","4","Active Rolling 3D Repeater"],["2013-06-11 00:00:00","92","New"],["2013-06-12 00:00:00","92","Active Rolling 3D"],["2013-06-13 00:00:00","92","Active Rolling 3D"],["2013-06-14 00:00:00","92","Active Rolling 3D"]]},"dateCreated":"May 31, 2016 9:24:07 PM","dateStarted":"Jun 6, 2016 8:04:36 AM","dateFinished":"Jun 6, 2016 8:05:36 AM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1825"},{"authenticationInfo":{},"dateUpdated":"Jun 6, 2016 8:04:34 AM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1464730155007_-200799389","id":"20160531-212915_352490215","result":{"code":"SUCCESS","type":"TEXT","msg":""},"dateCreated":"May 31, 2016 9:29:15 PM","dateStarted":"Jun 6, 2016 8:04:56 AM","dateFinished":"Jun 6, 2016 8:05:36 AM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1826"}],"name":"[MSS-DWH] Customers by Segments","id":"2BNR97C6S","angularObjects":{"2BFJ2NS5Z":[],"2BBXSPPGE":[],"2BC4MD68G":[],"2BCA5VUSP":[],"2BCP5YMKK":[],"2BDZVA7DF":[],"2BE47DYQY":[],"2BES4SCXE":[],"2BCVWFK97":[],"2BE2PGV8Y":[],"2BECFME3Z":[],"2BDH4D92N":[],"2BF329QF6":[]},"config":{"looknfeel":"default"},"info":{}}